<!DOCTYPE html>
<html lang="en" class="has-background-light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Project Log</title>
    
    <!-- Bulma CSS Framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Project styles -->
    <link rel="stylesheet" href="assets/css/base.css">
</head>
<body>

    <!-- Main Application Header -->
    <section class="section pt-4 pb-4 has-background-white shadow-sm">
        <div class="container">
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                        <h1 class="title is-3">
                            <span class="icon-text">
                                <span class="icon"><i class="fas fa-book"></i></span>
                                <span>Personal Project Log</span>
                            </span>
                        </h1>
                    </div>
                </div>
                <div class="level-right">
                    <div class="level-item">
                        <div class="buttons">
                            <button id="theme-toggle" class="button">
                                <span class="icon"><i class="fas fa-moon"></i></span>
                            </button>
                            <button id="reset-sample-btn" class="button is-danger is-light" title="Reset to bundled sample data (overwrites)">
                                <span class="icon"><i class="fas fa-rotate-left"></i></span>
                                <span>Reset Sample</span>
                            </button>
                            <a href="tests/index.html" class="button is-warning is-light" title="Run QUnit tests">Tests</a>
                            <button id="import-btn" class="button is-info is-light">
                                <span class="icon"><i class="fas fa-upload"></i></span>
                                <span>Import Data</span>
                            </button>
                            <button id="export-btn" class="button is-info">
                                <span class="icon"><i class="fas fa-download"></i></span>
                                <span>Export Data</span>
                            </button>
                            <input type="file" id="import-file" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
            <p class="is-size-7 has-text-grey" id="deprecation-note">Storage abstraction deprecated: now using direct localStorage in page scripts.</p>
        </div>
    </section>

    <!-- Main Application Body -->
    <section class="section main-container">
        <div class="container">
            <div class="columns">
                <!-- Left Column: Project List -->
                <div class="column is-one-quarter project-list-container">
                    <div class="box">
                        <h2 class="title is-5">My Projects</h2>
                        <form id="add-project-form" class="mb-4">
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    <input id="new-project-name" class="input" type="text" placeholder="New project name..." required>
                                </div>
                                <div class="control">
                                    <button class="button is-primary" title="Add Project">
                                        <span class="icon"><i class="fas fa-plus"></i></span>
                                    </button>
                                </div>
                            </div>
                        </form>
                        <div id="project-list">
                            <!-- Each project becomes an <a> link to project.html?id=...  -->
                        </div>
                    </div>
                </div>

                <!-- Right Column: Content Display -->
                <div class="column">
                    <div id="welcome-message" class="box has-text-centered">
                        <p class="is-size-5">Select a project to view its logs or add a new entry.</p>
                    </div>

                    <div id="project-content" style="display: none;">
                        <div class="box">
                            <h2 id="current-project-title" class="title is-4"></h2>
                             <div class="tabs is-boxed">
                                <ul>
                                    <li class="is-active" data-tab="log-entry"><a><span class="icon is-small"><i class="fas fa-plus-circle"></i></span><span>Add Log</span></a></li>
                                    <li data-tab="calendar-view"><a><span class="icon is-small"><i class="fas fa-calendar-alt"></i></span><span>Calendar View</span></a></li>
                                    <li data-tab="analysis-view"><a><span class="icon is-small"><i class="fas fa-chart-line"></i></span><span>Analysis</span></a></li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Log Entry Form -->
                        <div id="log-entry" class="tab-content is-active-view">
                            <div class="box">
                                <h3 class="title is-5">Log New Entry</h3>
                                <form id="log-form">
                                    <input type="hidden" id="log-id">
                                    <div class="field">
                                        <label class="label" for="log-date">Date</label>
                                        <div class="control">
                                            <input id="log-date" class="input" type="date" required>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label" for="log-results">Key Results</label>
                                        <div class="control">
                                            <textarea id="log-results" class="textarea" placeholder="What did you accomplish?" required></textarea>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label" for="log-observations">Observations</label>
                                        <div class="control">
                                            <textarea id="log-observations" class="textarea" placeholder="Any interesting findings or challenges?"></textarea>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label" for="log-reflections">Reflections</label>
                                        <div class="control">
                                            <textarea id="log-reflections" class="textarea" placeholder="How did it go? What could be improved?"></textarea>
                                        </div>
                                    </div>
                                    <div class="field is-grouped">
                                        <div class="control">
                                            <button type="submit" class="button is-link">Save Log Entry</button>
                                        </div>
                                        <div class="control">
                                            <button type="button" id="clear-form-btn" class="button is-light">Clear Form</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Calendar View -->
                        <div id="calendar-view" class="tab-content calendar-view">
                            <div class="box">
                                <div id="calendar"></div>
                            </div>
                        </div>

                        <!-- Analysis View -->
                        <div id="analysis-view" class="tab-content analysis-view">
                            <div class="box">
                                <h3 class="title is-5">Project Analytics</h3>
                                <nav class="level is-mobile">
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">Total Logs</p>
                                            <p id="total-logs" class="title">0</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">First Log</p>
                                            <p id="first-log-date" class="title">N/A</p>
                                        </div>
                                    </div>
                                    <div class="level-item has-text-centered">
                                        <div>
                                            <p class="heading">Last Log</p>
                                            <p id="last-log-date" class="title">N/A</p>
                                        </div>
                                    </div>
                                </nav>
                                <hr>
                                <h4 class="title is-6">Log Activity (Last 30 Days)</h4>
                                <progress id="activity-bar" class="progress is-success" value="0" max="30"></progress>
                                <p id="activity-text">0 / 30 days with activity.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal for viewing/editing a log entry -->
    <div id="log-modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Log Entry Details</p>
                <button class="delete" aria-label="close"></button>
            </header>
            <section class="modal-card-body">
                <p><strong>Project:</strong> <span id="modal-project-name"></span></p>
                <p class="mb-4"><strong>Date:</strong> <span id="modal-log-date"></span></p>
                <div class="content">
                    <h4>Key Results</h4>
                    <p id="modal-log-results"></p>
                    <h4>Observations</h4>
                    <p id="modal-log-observations"></p>
                    <h4>Reflections</h4>
                    <p id="modal-log-reflections"></p>
                </div>
            </section>
            <footer class="modal-card-foot">
                <button id="edit-log-btn" class="button is-info">Edit</button>
                <button id="delete-log-btn" class="button is-danger">Delete</button>
                <button class="button modal-close-btn">Close</button>
            </footer>
        </div>
    </div>

    <!-- Modal for Import Options -->
    <div id="import-modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Import Data</p>
                <button class="delete" aria-label="close"></button>
            </header>
            <section class="modal-card-body">
                <div class="notification is-warning">
                    <p>
                        <strong>Warning:</strong> Importing data can overwrite your existing projects and logs. It is highly recommended to back up your current data first.
                    </p>
                </div>
                <div class="field">
                    <a id="backup-before-import-btn" class="button is-fullwidth is-link">
                        <span class="icon"><i class="fas fa-download"></i></span>
                        <span>Download Backup (.json)</span>
                    </a>
                </div>
                <hr>
                <p class="mb-2">Choose an import mode:</p>
                <div class="control">
                    <label class="radio">
                        <input type="radio" name="import-mode" value="merge" checked>
                        <strong>Merge:</strong> Add new data and update existing entries. (Safer)
                    </label>
                    <p class="is-size-7 ml-5 mb-3">Merges projects and logs. If an item in the import file has the same ID as an existing item, the imported item will replace it. If the names match but IDs don't, it will be treated as a new item.</p>
                    <label class="radio">
                        <input type="radio" name="import-mode" value="overwrite">
                        <strong>Overwrite:</strong> Delete all current data and replace it with the imported data.
                    </label>
                     <p class="is-size-7 ml-5">This will completely erase your current projects and logs. Use with caution.</p>
                    <div id="import-summary" class="mt-4 is-size-7 has-text-grey"></div>
                    <p id="import-status" class="mt-2 is-size-7"></p>
                </div>
            </section>
            <footer class="modal-card-foot">
                <button id="confirm-import-btn" class="button is-success">Proceed with Import</button>
                <button class="button modal-close-btn">Cancel</button>
            </footer>
        </div>
    </div>


    <!-- Legacy scripts removed in Phase 4 cleanup (storage / main / render) -->
    <!-- ES module scripts (Phase 1) -->
    <script type="module" src="assets/js/theme.js"></script>
    <script type="module" src="assets/js/utils.mod.js"></script>
    <script type="module" src="assets/js/data.js"></script>
    <script type="module" src="assets/js/index.js"></script>
</body>
</html>
